language: cpp

jobs:
    include:
        - os: linux
          name: "FesapiCpp with dynamic HDF5 (clang 5.0.0), unit test and RESQML2.2"
          dist: trusty
          compiler: clang
          script:
            - mkdir ../build
            - cd ../build
            - cmake $TRAVIS_BUILD_DIR
                -DUUID_INCLUDE_DIR=/usr/include
                -DUUID_LIBRARY_RELEASE=/usr/lib/x86_64-linux-gnu/libuuid.so
                -DHDF5_C_INCLUDE_DIR=/usr/include
                -DHDF5_C_LIBRARY_RELEASE=/usr/lib/x86_64-linux-gnu/libhdf5.so
                -DMINIZIP_INCLUDE_DIR=$TRAVIS_BUILD_DIR/../dependencies/minizip-install/include
                -DMINIZIP_LIBRARY_RELEASE=$TRAVIS_BUILD_DIR/../dependencies/minizip-install/lib/libminizip.a
                -DZLIB_INCLUDE_DIR=/usr/include
                -DZLIB_LIBRARY_RELEASE=/usr/lib/x86_64-linux-gnu/libz.so
                -DWITH_EXAMPLE=TRUE
                -DWITH_RESQML2_2=TRUE
                -DWITH_TEST=TRUE
            - cmake --build . -- -j 2
            - ./example/example
            - ctest -V
addons:
  apt:
    packages:
      - uuid-dev
      - zlib1g-dev
      - libhdf5-dev #1.8.11

install:
  - sudo apt-get purge cmake;
  - sudo apt-get purge swig;
  - sudo rm -rf /usr/local/cmake-*
  - mkdir ../dependencies
  - cd ../dependencies
  - wget https://cmake.org/files/v3.12/cmake-3.12.0-Linux-x86_64.sh;
  - sudo sh cmake-3.12.0-Linux-x86_64.sh --prefix=/usr/local --exclude-subdir;
  - git clone https://github.com/F2I-Consulting/Minizip.git
  - cd Minizip
  - mkdir build
  - cd build
  - cmake -G "Unix Makefiles" -DCMAKE_INSTALL_PREFIX:STRING=../../minizip-install ..
  - cmake --build . --config Release
  - make install
  - cd ../..
  - wget http://prdownloads.sourceforge.net/swig/swig-4.0.2.tar.gz;
  - tar -xzf swig-4.0.2.tar.gz;
  - cd swig-4.0.2;
  - ./configure;
  - make;
  - sudo make install;
