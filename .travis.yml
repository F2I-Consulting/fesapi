language: cpp

matrix:
    include:
        - os: linux
          name: "FesapiCpp with dynamic HDF5 (gcc 4.8.4)"
          sudo: required
          dist: trusty
          compiler: gcc
          script:
            - cmake --version
            - mkdir ../build
            - cd ../build
            - cmake $TRAVIS_BUILD_DIR
                -DUUID_INCLUDE_DIR=/usr/include
                -DUUID_LIBRARY_RELEASE=/usr/lib/x86_64-linux-gnu/libuuid.so
                -DHDF5_C_INCLUDE_DIR=$TRAVIS_BUILD_DIR/../dependencies/hdf5-1.8.18-linux-centos7-x86_64-gcc485-noszip-shared/include
                -DHDF5_C_LIBRARY_RELEASE=$TRAVIS_BUILD_DIR/../dependencies/hdf5-1.8.18-linux-centos7-x86_64-gcc485-noszip-shared/lib/libhdf5.so
                -DMINIZIP_INCLUDE_DIR=$TRAVIS_BUILD_DIR/../dependencies/minizip-1.1-linux-ubuntu1604-x86_64-gcc540/include
                -DMINIZIP_LIBRARY_RELEASE=$TRAVIS_BUILD_DIR/../dependencies/minizip-1.1-linux-ubuntu1604-x86_64-gcc540/lib/libminizip.a
                -DZLIB_INCLUDE_DIR=$TRAVIS_BUILD_DIR/../dependencies/hdf5-1.8.18-linux-centos7-x86_64-gcc485-noszip-shared/include
                -DZLIB_LIBRARY_RELEASE=$TRAVIS_BUILD_DIR/../dependencies/hdf5-1.8.18-linux-centos7-x86_64-gcc485-noszip-shared/lib/libz.so
            - cmake --build .
            - ./example/example
        - os: linux
          name: "FesapiCpp with dynamic HDF5 (clang 5.0.0)"
          sudo: required
          dist: trusty
          compiler: clang
          script:
            - cmake --version
            - mkdir ../build
            - cd ../build
            - cmake $TRAVIS_BUILD_DIR
                -DUUID_INCLUDE_DIR=/usr/include
                -DUUID_LIBRARY_RELEASE=/usr/lib/x86_64-linux-gnu/libuuid.so
                -DHDF5_C_INCLUDE_DIR=$TRAVIS_BUILD_DIR/../dependencies/hdf5-1.8.18-linux-centos7-x86_64-gcc485-noszip-shared/include
                -DHDF5_C_LIBRARY_RELEASE=$TRAVIS_BUILD_DIR/../dependencies/hdf5-1.8.18-linux-centos7-x86_64-gcc485-noszip-shared/lib/libhdf5.so
                -DMINIZIP_INCLUDE_DIR=$TRAVIS_BUILD_DIR/../dependencies/minizip-1.1-linux-ubuntu1604-x86_64-gcc540/include
                -DMINIZIP_LIBRARY_RELEASE=$TRAVIS_BUILD_DIR/../dependencies/minizip-1.1-linux-ubuntu1604-x86_64-gcc540/lib/libminizip.a
                -DZLIB_INCLUDE_DIR=$TRAVIS_BUILD_DIR/../dependencies/hdf5-1.8.18-linux-centos7-x86_64-gcc485-noszip-shared/include
                -DZLIB_LIBRARY_RELEASE=$TRAVIS_BUILD_DIR/../dependencies/hdf5-1.8.18-linux-centos7-x86_64-gcc485-noszip-shared/lib/libz.so
            - cmake --build .
            - ./example/example
        - os: osx
          name: "FesapiCpp with dynamic HDF5 (xcode10)"
          osx_image: xcode10
          script:
            - cmake --version
            - mkdir ../build
            - cd ../build
            - cmake $TRAVIS_BUILD_DIR
                -DUUID_INCLUDE_DIR=/usr/include
                -DUUID_LIBRARY_RELEASE=/usr/lib/x86_64-linux-gnu/libuuid.so
                -DHDF5_C_INCLUDE_DIR=$TRAVIS_BUILD_DIR/../dependencies/hdf5-1.8.18-linux-centos7-x86_64-gcc485-noszip-shared/include
                -DHDF5_C_LIBRARY_RELEASE=$TRAVIS_BUILD_DIR/../dependencies/hdf5-1.8.18-linux-centos7-x86_64-gcc485-noszip-shared/lib/libhdf5.so
                -DMINIZIP_INCLUDE_DIR=$TRAVIS_BUILD_DIR/../dependencies/minizip-1.1-linux-ubuntu1604-x86_64-gcc540/include
                -DMINIZIP_LIBRARY_RELEASE=$TRAVIS_BUILD_DIR/../dependencies/minizip-1.1-linux-ubuntu1604-x86_64-gcc540/lib/libminizip.a
                -DZLIB_INCLUDE_DIR=$TRAVIS_BUILD_DIR/../dependencies/hdf5-1.8.18-linux-centos7-x86_64-gcc485-noszip-shared/include
                -DZLIB_LIBRARY_RELEASE=$TRAVIS_BUILD_DIR/../dependencies/hdf5-1.8.18-linux-centos7-x86_64-gcc485-noszip-shared/lib/libz.so
            - cmake --build .
            - ./example/example
addons:
  apt:
    packages:
      - uuid-dev
      - zlib1g-dev
      - libhdf5-dev #1.8.11
      - swig
  homebrew:
    packages:
      - ossp-uuid
      - hdf5@1.8 #1.8.21

install:
  - if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then sudo apt-get purge cmake; fi
  - sudo rm -rf /usr/local/cmake-*
  - mkdir ../dependencies
  - cd ../dependencies
  - if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then
      wget https://github.com/untereiner/Minizip/releases/download/1.2/Minizip-linux.zip;
      unzip Minizip-linux.zip -d Minizip-linux;
      wget https://cmake.org/files/v3.12/cmake-3.12.0-Linux-x86_64.sh;
      sudo sh cmake-3.12.0-Linux-x86_64.sh --prefix=/usr/local --exclude-subdir;
    fi
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then 
      wget https://github.com/untereiner/Minizip/releases/download/1.2/Minizip-osx.zip;
      unzip Minizip-osx.zip -d Minizip-osx;
    fi
