name: github-actions
on: [push, pull_request]
jobs:
  ubuntu-20-java8:
    runs-on: ubuntu-20.04
    steps:
      - uses: actions/checkout@v2
      - uses: actions/setup-java@v2
        with:
          distribution: 'temurin' # See 'Supported distributions' for available options
          java-version: '8'
      - name: APT install
        run: |
          sudo apt update
          sudo apt install -y libhdf5-dev libminizip-dev libboost-all-dev
      - name: CMake build and install
        run: |
          cd ..
          mkdir build
          cd build
          cmake -DHDF5_C_INCLUDE_DIR=/usr/include/hdf5/serial -DHDF5_C_LIBRARY_RELEASE=/usr/lib/x86_64-linux-gnu/libhdf5_serial.so.103.0.0 -DMINIZIP_INCLUDE_DIR=/usr/include/minizip -DMINIZIP_LIBRARY_RELEASE=/usr/lib/x86_64-linux-gnu/libminizip.so.1.0.0 -DZLIB_INCLUDE_DIR=/usr/include -DZLIB_LIBRARY_RELEASE=/lib/x86_64-linux-gnu/libz.so.1.2.11 -DCMAKE_BUILD_TYPE=Release -DWITH_JAVA_WRAPPING=TRUE ${{ github.workspace }}
          cmake --build . -j2
          cmake --install .
      - name: Run java example
        run: |
          cd ${{ github.workspace }}/java/src
          javac -cp `find ${{ github.workspace }}/../build/install -name fesapiJava*.jar` com/f2i_consulting/example/FesapiJavaExample.java
          java -Djava.library.path=${{ github.workspace }}/../build/install/lib -cp `find ${{ github.workspace }}/../build/install -name fesapiJava*.jar`:. com.f2i_consulting.example.FesapiJavaExample
